IF (:transaction_type IN ('A','U') AND (:Object_type IN ('1470000113','22','20','18'))) THEN UPDATE T0 SET "U_Z_PRApprvd" = IFNULL(T1."Amount", 0), "U_Z_ABudget" = "U_Z_Budget" - (IFNULL(T1."Amount", 0) + IFNULL("U_Z_POApprvd", 0) + IFNULL("U_Z_GRApprvd", 0) + IFNULL("U_Z_IVApprvd", 0)) FROM "@Z_BUDDF1" T0 LEFT OUTER JOIN (SELECT T0."DocEntry", T0."LineID", IFNULL(SUM(IFNULL(T2."LineTotal", 0)), 0) AS "Amount" FROM "@Z_BUDDF1" T0 INNER JOIN "@Z_OBUDDF" T1 ON T0."DocEntry" = T1."DocEntry" INNER JOIN PRQ1 T2 ON T0."U_Category" = T2."Dscription" AND IFNULL(T0."U_OcrCode", '') = IFNULL(T2."OcrCode", '') AND IFNULL(T0."U_OcrCode2", '') = IFNULL(T2."OcrCode2", '') AND IFNULL(T0."U_OcrCode3", '') = IFNULL(T2."OcrCode3", '') AND IFNULL(T0."U_OcrCode4", '') = IFNULL(T2."OcrCode4", '') AND IFNULL(T0."U_OcrCode5", '') = IFNULL(T2."OcrCode4", '') INNER JOIN OPRQ T3 ON T2."DocEntry" = T3."DocEntry" AND Year(T3."DocDate") = T1."U_Year" WHERE T3."DocType" = 'S' AND T2."LineStatus" = 'O' GROUP BY T0."DocEntry", T0."LineID") AS T1 ON T0."DocEntry" = T1."DocEntry" AND T0."LineID" = T1."LineID";
--Purchase Order
UPDATE T0 SET "U_Z_POApprvd" = IFNULL(T1."Amount", 0), "U_Z_ABudget" = "U_Z_Budget" - (IFNULL("U_Z_PRApprvd", 0) + IFNULL(T1."Amount", 0) + IFNULL("U_Z_GRApprvd", 0) + IFNULL("U_Z_IVApprvd", 0)) FROM "@Z_BUDDF1" T0 LEFT OUTER JOIN (SELECT T0."DocEntry", T0."LineID", IFNULL(SUM(IFNULL(T2."LineTotal", 0)), 0) AS "Amount" FROM "@Z_BUDDF1" T0 INNER JOIN "@Z_OBUDDF" T1 ON T0."DocEntry" = T1."DocEntry" INNER JOIN POR1 T2 ON T0."U_Category" = T2."Dscription" AND IFNULL(T0."U_OcrCode", '') = IFNULL(T2."OcrCode", '') AND IFNULL(T0."U_OcrCode2", '') = IFNULL(T2."OcrCode2", '') AND IFNULL(T0."U_OcrCode3", '') = IFNULL(T2."OcrCode3", '') AND IFNULL(T0."U_OcrCode4", '') = IFNULL(T2."OcrCode4", '') AND IFNULL(T0."U_OcrCode5", '') = IFNULL(T2."OcrCode4", '') INNER JOIN OPOR T3 ON T2."DocEntry" = T3."DocEntry" AND Year(T3."DocDate") = T1."U_Year" WHERE T3."DocType" = 'S' AND T2."LineStatus" = 'O' GROUP BY T0."DocEntry", T0."LineID") AS T1 ON T0."DocEntry" = T1."DocEntry" AND T0."LineID" = T1."LineID";
--GRPO
UPDATE T0 SET "U_Z_GRApprvd" = IFNULL(T1."Amount", 0), "U_Z_ABudget" = "U_Z_Budget" - (IFNULL("U_Z_PRApprvd", 0) + IFNULL("U_Z_POApprvd", 0) + IFNULL(T1."Amount", 0) + IFNULL("U_Z_IVApprvd", 0)) FROM "@Z_BUDDF1" T0 LEFT OUTER JOIN (SELECT T0."DocEntry", T0."LineID", IFNULL(SUM(IFNULL(T2."LineTotal", 0)), 0) AS "Amount" FROM "@Z_BUDDF1" T0 INNER JOIN "@Z_OBUDDF" T1 ON T0."DocEntry" = T1."DocEntry" INNER JOIN PDN1 T2 ON T0."U_Category" = T2."Dscription" AND IFNULL(T0."U_OcrCode", '') = IFNULL(T2."OcrCode", '') AND IFNULL(T0."U_OcrCode2", '') = IFNULL(T2."OcrCode2", '') AND IFNULL(T0."U_OcrCode3", '') = IFNULL(T2."OcrCode3", '') AND IFNULL(T0."U_OcrCode4", '') = IFNULL(T2."OcrCode4", '') AND IFNULL(T0."U_OcrCode5", '') = IFNULL(T2."OcrCode4", '') INNER JOIN OPDN T3 ON T2."DocEntry" = T3."DocEntry" AND Year(T3."DocDate") = T1."U_Year" WHERE T3."DocType" = 'S' AND T2."LineStatus" = 'O' GROUP BY T0."DocEntry", T0."LineID") AS T1 ON T0."DocEntry" = T1."DocEntry" AND T0."LineID" = T1."LineID";
--INVOICE
UPDATE T0 SET "U_Z_IVApprvd" = IFNULL(T1."Amount", 0), "U_Z_ABudget" = "U_Z_Budget" - (IFNULL("U_Z_PRApprvd", 0) + IFNULL("U_Z_POApprvd", 0) + IFNULL("U_Z_GRApprvd", 0) + IFNULL(T1."Amount", 0)) FROM "@Z_BUDDF1" T0 LEFT OUTER JOIN (SELECT T0."DocEntry", T0."LineID", IFNULL(SUM(IFNULL(T2."LineTotal", 0)), 0) AS "Amount" FROM "@Z_BUDDF1" T0 INNER JOIN "@Z_OBUDDF" T1 ON T0."DocEntry" = T1."DocEntry" INNER JOIN PCH1 T2 ON T0."U_Category" = T2."Dscription" AND IFNULL(T0."U_OcrCode", '') = IFNULL(T2."OcrCode", '') AND IFNULL(T0."U_OcrCode2", '') = IFNULL(T2."OcrCode2", '') AND IFNULL(T0."U_OcrCode3", '') = IFNULL(T2."OcrCode3", '') AND IFNULL(T0."U_OcrCode4", '') = IFNULL(T2."OcrCode4", '') AND IFNULL(T0."U_OcrCode5", '') = IFNULL(T2."OcrCode4", '') INNER JOIN OPCH T3 ON T2."DocEntry" = T3."DocEntry" AND Year(T3."DocDate") = T1."U_Year" WHERE T3."DocType" = 'S' AND T2."LineStatus" = 'O' GROUP BY T0."DocEntry", T0."LineID") AS T1 ON T0."DocEntry" = T1."DocEntry" AND T0."LineID" = T1."LineID";
END IF;
--Purchase Request
